---
import { getCollection, getEntryBySlug } from "astro:content";
import dayjs from "dayjs";
import BaseLayout from "../../layouts/BaseLayout.astro";
import Prose from "../../layouts/Prose.astro";
const blogBlurb = await getEntryBySlug("blurbs", "blog");

const { Content } = await blogBlurb.render();
const blogEntries = await getCollection("blog", ({ data }) => {
    return data.draft !== true;
});

const projectsEntries = await getCollection("projects");
const allEntries = [...blogEntries, ...projectsEntries].sort((a, b) => {
    return dayjs(b.data.pubDate).unix() - dayjs(a.data.pubDate).unix();
});

// console.log(allEntries);
---

<BaseLayout title="Ryan's Blog Posts" description="">
    <h1 class="pb-2 text-xl text-red-400">
        {blogBlurb.data.title}
    </h1>
    <Prose>
        <Content />
    </Prose>
    <div>
        {
            allEntries.map((post) => (
                <a href={`/${post.collection}/${post.slug}`} class="block pb-2">
                    <p class="text-base font-semibold text-blue-400 hover:text-orange-200 md:text-lg">
                        {post.data.title}
                    </p>
                    <div class="flex items-center">
                        <span class="text-xs text-gray-200">
                            {post.collection}
                        </span>
                        <time
                            class="text-xs italic text-gray-200"
                            datetime={post.data.pubDate.toISOString()}
                        >
                            &bull;{" "}
                            {dayjs(post.data.pubDate).format("YYYY-MM-DD")}
                        </time>
                    </div>
                    <p class="text-sm text-gray-200">{post.data.description}</p>
                </a>
            ))
        }
    </div>
</BaseLayout>
